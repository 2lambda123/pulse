import ct_jade
import numpy as np
import json

message = "29.627510570824523,29.381871035940804,29.45811310782241,29.564878435517972,29.69701374207188,29.667441860465118,29.184883720930234,29.754651162790697,29.62622739018088,29.62622739018088,29.475581395348836,29.597967479674796,29.27628726287263,29.621544715447154,29.858130081300814,29.962330623306233,30.062466124661245,30.005284552845527,29.91910569105691,29.95731707317073,29.968157181571815,30.023441734417343,30.005420054200542,29.985636856368565,30.565615058324497,30.188759278897138,30.286983032873806,30.296394485683987,30.296394485683987,30.335763520678686,30.849549310710497,30.681203605514316,30.689289501590668,30.689289501590668,30.21517615176152,30.763165188470065,31.20371396895787,31.20371396895787,30.89287694013304,31.107723577235774,30.56495227995758,30.5092788971368,30.474681866383882,30.326749734888654,30.395811240721102,30.351139978791092,30.351139978791092,30.358695652173914,30.349019088016966,30.6342788971368,30.597560975609756,30.599416755037115,30.08739837398374,30.448644986449864,30.35691056910569,30.285365853658536,30.262059620596204,30.282249322493225,30.373441734417344,30.025880758807588,30.14281842818428,30.128184281842817,30.183468834688348,30.243631436314363,30.175880758807587,30.119647696476964,30.12249322493225,30.066531165311652,30.03130081300813,30.03048780487805,30.555805938494167,29.879506892895016,29.868769883351007,30.29931071049841,30.3148197242842,30.26179745493107,30.26179745493107,30.34544008483563,30.300106044538705,30.352200424178154,30.360286320254506,30.32051961823966,30.287645811240722,30.264050901378578,30.29745493107105,30.31959172852598,30.278499469777305,30.27584835630965,30.34398197242842,30.464475079533404,30.653366914103923,30.322640509013787,30.452677624602334,30.166489925768822,30.25755567338282,30.182529162248144,29.92087967644085,29.406723963599596,29.077603640040444,29.077603640040444,29.13612234580384,28.743824110671937,28.262475296442688,28.22467885375494,28.22467885375494,28.17551877470356,29.05163043478261,29.460439838220424,29.311425682507583,29.309908998988877,29.39041961577351,29.391683518705765,29.36438321536906,29.318756319514662,29.318756319514662,29.691860465116278,29.751263902932255,29.762386248736096,29.762386248736096,29.762386248736096,29.73129423660263,29.72573306370071,29.20090439276486,29.711284355179703,30.456527484143763,30.407241014799155,30.01281712473573,30.116807610993657,30.420038802660756,30.475332594235034,30.475332594235034,30.81430155210643,30.734478935698448,30.711058758314856,30.61640798226164,30.61640798226164,30.63830376940133,30.724916851441243,30.732954545454547,30.64550997782705,30.70842572062084,30.669068736141906,30.709811529933482,30.706624168514413,30.670731707317074,30.732538802660756,30.732538802660756,30.66380266075388,30.71798780487805,30.620565410199557,30.618763858093125,30.576912416851442,30.551967849223946,30.55030487804878,30.549750554323726,30.562361419068736,30.55820399113082,30.541158536585368,30.514135254988915,30.477549889135254,30.517461197339244,30.509284922394677,30.51690687361419,30.510532150776054,30.504850332594234,30.444844789356985,30.420731707317074,30.47588691796009,30.437222838137473,30.264038570618265,30.671866137266022,30.21710153148043,30.22447532614861,30.187889960294953,30.16406693136699,30.165343165059557,30.23284174702212,30.23284174702212,30.263613159387408,30.458148558758314,29.70967294900222,30.02979490022173,30.079545454545453,30.092017738359203,30.083841463414632,30.12610864745011,30.01787694013304,30.08259423503326,30.13608647450111,30.127910199556542,30.10670731707317,30.197339246119736,30.24570399113082,30.27840909090909,30.227272727272727,30.177383592017737,30.184174057649667,30.26621396895787,30.21008869179601,30.22117516629712,30.166712860310422,30.177522172949,30.177522172949,30.26621396895787,30.325388026607538,30.308065410199557,30.27771618625277,30.178630820399114,30.195953436807095,30.16851441241685,30.150914634146343,30.093957871396896,30.051552106430155,30.098669623059866,30.15659645232816,30.122644124168513,30.113359201773836,30.22159090909091,30.252355875831487,30.174334811529935,30.141768292682926,30.141768292682926,30.141768292682926,29.725055432372507,29.491823725055433,29.04353374929098,28.88372093023256,28.05445263754963,26.918321043675554,27.388825865002836,27.380317640385705,28.000283607487237,29.00127623369257,29.424134997163925,29.858621667612024,29.79919623059867,28.803514799154335,28.803514799154335,28.68152454780362,28.74026794742164,28.146615612648223,28.3122582205029,28.255326704545453,28.453038033395178,28.60482374768089,28.552295918367346,28.650046382189238,28.756725417439704,29.291048237476808,29.411525974025974,28.66182342502218,29.195319432120673,29.138642413487133,29.185115350488022,28.507586050724637,28.889266304347824,24.889270613107822,24.77906976744186,24.93644291754757,25.156712473572938,25.199127906976745,25.091472868217053,24.709560723514212,25.071447028423773,25.106589147286822,25.106589147286822,24.98488372093023,25.08888888888889,24.73048780487805,25.11219512195122,25.29308943089431,25.416260162601628,25.475338753387533,25.369647696476964,25.275474254742548,25.275474254742548,25.218970189701896,25.363956639566396,25.351219512195122,25.336449864498643,26.012990455991517,25.590933191940614,25.579533404029693,25.669008483563097,25.669008483563097,25.66529692470838,26.167948038176036,26.00702545068929,26.015906680805937,26.015906680805937,25.541327913279133,26.126247228381374,26.512749445676274,26.512749445676274,26.268847006651885,26.46761517615176,25.942603393425237,25.834305408271472,25.736214209968185,25.735551431601273,25.679878048780488,25.692735949098623,25.692735949098623,25.719247083775187,25.737407211028632,26.08324496288441,26.090535524920465,26.00092788971368,25.45460704607046,25.730623306233063,25.72289972899729,25.744037940379403,25.711924119241193,25.696612466124662,25.803116531165312,25.48157181571816,25.604065040650408,25.735365853658536,25.672628726287265,25.663143631436313,25.67791327913279,25.634417344173443,25.639024390243904,25.587669376693768,25.573712737127373,25.53021680216802,26.12367444326617,25.453340402969246,25.442338282078474,25.80965005302227,25.836823966065747,25.799045599151643,25.799045599151643,25.88480911983033,25.87460233297985,25.816012725344645,25.79268292682927,25.74005832449629,25.688759278897138,25.649655355249205,25.63255567338282,25.691012725344645,25.70877518557794,25.745360551431602,25.82144750795334,25.99098621420997,26.15641569459173,25.901113467656415,25.95029162248144,25.6118769883351,25.66675503711559,25.65787380699894,25.339989888776543,24.884858442871586,24.55927704752275,24.55927704752275,24.546511627906977,24.293601778656125,23.86326581027668,23.787672924901187,23.787672924901187,23.735054347826086,24.449851778656125,24.77565722952477,24.564964610717897,24.706268958543983,24.733948432760364,24.65849342770475,24.648003033367036,24.636880687563195,24.636880687563195,24.969413549039434,25.089610717896864,25.03854903943377,25.03854903943377,25.03854903943377,24.950455005055613,24.952603640040444,24.383204134366924,24.78514799154334,25.57835623678647,25.59487315010571,25.23242600422833,25.26559196617336,25.483924611973393,25.539634146341463,25.539634146341463,25.7779933481153,25.68500554323725,25.680570953436806,25.65022172949002,25.65022172949002,25.632067627494457,25.649944567627493,25.676552106430155,25.735033259423503,25.769539911308204,25.771341463414632,25.85740022172949,25.83148558758315,25.795870288248338,25.721868070953438,25.721868070953438,25.749029933481154,25.60961751662971,25.666158536585368,25.701912416851442,25.70967294900222,25.670870288248338,25.754988913525498,25.730321507760532,25.712583148558757,25.638858093126387,25.661031042128602,25.61668514412417,25.60171840354767,25.562222838137473,25.606984478935697,25.613220620842572,25.66768292682927,25.738774944567627,25.738636363636363,25.70759423503326,25.70288248337029,25.75429600886918,25.56834940442428,25.951077708451503,25.456608054452637,25.39208735110607,25.400028360748724,25.4028644356211,25.393647192285876,25.536159954622804,25.536159954622804,25.532331253545095,25.836890243902438,25.064440133037692,25.468542128603104,25.34340354767184,25.32580376940133,25.30307649667406,25.36890243902439,25.32649667405765,25.39869733924612,25.352688470066518,25.40978381374723,25.449279379157428,25.527577605321508,25.623059866962308,25.71161308203991,25.67211751662971,25.72422394678492,25.656457871396896,25.60989467849224,25.55141352549889,25.61391352549889,25.631236141906875,25.52660753880266,25.52660753880266,25.55529379157428,25.62569290465632,25.591740576496672,25.61419068736142,25.573170731707318,25.574972283813747,25.49528824833703,25.411585365853657,25.402439024390244,25.481568736141906,25.43029379157428,25.392045454545453,25.411446784922394,25.525083148558757,25.62818736141907,25.670870288248338,25.73129157427938,25.5789911308204,25.5789911308204,25.5789911308204,25.070537694013304,24.869733924611975,24.521412365286444,24.33749290981282,23.534174702212137,22.726318774815656,23.072319909245603,23.034600113442995,23.511344299489508,24.447674418604652,24.793391945547363,25.296653431650597,25.147865853658537,24.563028541226217,24.563028541226217,24.257235142118862,24.202224469160768,23.816576086956523,23.926982591876207,23.900213068181817,24.08256029684601,24.159554730983302,24.161294063079776,24.029568645640076,24.151553803339517,24.507769016697587,24.65688775510204,24.153726708074533,24.63642413487134,24.685115350488022,24.635314995563444,24.044270833333332,24.32518115942029,19.20573467230444,19.18948202959831,19.261627906976745,19.35821881606765,19.53792283298097,19.69341085271318,19.278682170542634,19.696770025839793,19.655038759689923,19.655038759689923,19.486304909560722,19.559756097560975,19.259620596205963,19.315040650406505,19.65257452574526,19.766666666666666,19.603252032520324,19.75,19.761653116531164,19.664227642276423,19.396341463414632,19.545528455284554,19.522493224932248,19.500135501355015,20.039103923647932,19.784066808059386,19.71712619300106,19.694194061505833,19.694194061505833,19.808191940615057,20.38958112407211,20.12539766702015,20.26922057264051,20.26922057264051,19.93888888888889,20.3009977827051,20.558619733924612,20.558619733924612,20.57220066518847,20.74010840108401,20.386002120890772,20.422587486744433,20.23926299045599,20.20864262990456,20.03154825026511,20.043875927889715,20.043875927889715,20.02306468716861,20.066940615058325,20.35233297985154,20.29003181336161,20.38533934252386,19.99878048780488,20.22140921409214,20.233739837398375,20.208265582655827,20.173441734417345,20.07750677506775,20.103658536585368,19.934417344173443,19.947560975609758,19.952845528455285,20.188346883468835,20.15989159891599,20.104336043360433,20.208130081300812,20.11178861788618,20.024932249322493,20.022222222222222,20.06056910569106,20.500662778366912,19.939289501590668,19.950556733828208,20.08165429480382,20.16542948038176,20.284464475079535,20.284464475079535,20.192735949098623,20.148860021208908,20.12486744432662,20.115323435843052,20.014050901378578,20.170731707317074,20.1427624602333,20.133748674443265,20.038838812301165,20.11797454931071,20.191145281018027,20.32608695652174,20.43186638388123,20.62486744432662,20.443266171792153,20.353525980911982,20.230911983032875,20.21805408271474,20.26550901378579,19.90520728008089,19.813195146612742,19.50758341759353,19.50758341759353,19.36691102123357,19.062870553359684,18.776062252964426,18.742959486166008,18.742959486166008,18.600049407114625,19.14735671936759,19.384984833164815,19.283619817997977,19.309024266936298,19.184782608695652,19.106673407482305,19.13650151668352,19.11577350859454,19.11577350859454,19.432128412537917,19.325455005055613,19.255434782608695,19.255434782608695,19.255434782608695,19.2703488372093,19.205763397371083,18.97377260981912,19.32359936575053,19.96762684989429,20.13887420718816,19.832188160676534,19.75,19.870011086474502,19.86419068736142,19.86419068736142,19.966186252771617,20.03921840354767,19.98572616407982,20.02258869179601,20.02258869179601,20.081624168514413,19.998337028824835,20.09562084257206,20.15382483370288,20.052245011086473,20.194567627494457,20.006236141906875,20.070121951219512,20.134284922394677,20.045870288248338,20.045870288248338,19.859756097560975,19.909229490022174,19.90507206208426,19.828159645232816,19.910753880266075,19.97228381374723,19.81291574279379,19.866962305986696,19.748752771618626,19.89232261640798,19.844789356984478,19.8470066518847,19.755958980044348,19.877910199556542,19.93930155210643,19.883176274944567,19.81887472283814,19.782150776053214,19.79351441241685,19.90077605321508,19.85241130820399,19.77882483370288,19.602382302892796,19.90031196823596,19.58607487237663,19.65272263187748,19.723624503686896,19.68165059557572,19.715683494044242,19.669313669880886,19.669313669880886,19.703062960862166,19.77411308203991,19.249445676274945,19.605737250554323,19.650083148558757,19.620149667405766,19.670454545454547,19.53270509977827,19.791158536585368,19.610864745011085,19.630958980044348,19.689162971175165,19.78339800443459,19.754434589800443,19.715077605321508,19.73780487804878,19.852272727272727,19.815825942350333,19.893015521064303,19.86529933481153,19.95260532150776,19.863359201773836,19.89911308203991,19.846036585365855,19.846036585365855,19.827466740576497,19.621258314855876,19.64980598669623,19.635532150776054,19.746258314855876,19.593126385809313,19.64717294900222,19.656180709534368,19.648143015521065,19.649390243902438,19.690410199556542,19.816934589800443,19.834950110864746,19.81929046563193,19.830654101995567,19.857815964523283,19.868348115299334,19.89287694013304,19.89287694013304,19.89287694013304,19.528686252771617,19.293652993348115,18.775808281338627,18.557714123652865,18.360890527509927,17.574305161656266,17.88967668746455,17.953062960862166,18.27169597277368,18.86301758366421,19.234685195689167,19.675411230856493,19.644539911308204,19.08615221987315,19.08615221987315,19.1109819121447,19.09428715874621,18.710597826086957,18.809235976789168,18.803385416666668,18.93958719851577,19.101345083487942,19.083256029684602,18.944921150278294,18.8612012987013,19.22077922077922,19.304499072356215,18.945541259982253,19.51064773735581,19.418589174800356,19.478482697426795,19.174479166666668,19.25305706521739"


def parse_RGB(message, buffer_window):
	rgb_list = np.array(map(float, message.split(',')))
	X = np.ndarray(shape = (3, buffer_window), buffer= rgb_list)
	ICA = ct_jade.main(X)
	return json.dumps(parse_ICA_results(ICA))

def parse_ICA_results(ICA):
	signals = {}
	signals["one"] = np.squeeze(np.asarray(ICA[:, 0])).tolist()
	signals["two"] = np.squeeze(np.asarray(ICA[:, 1])).tolist()
	signals["three"] = np.squeeze(np.asarray(ICA[:, 2])).tolist()
	
	return signals


parse_RGB(message, 256)
